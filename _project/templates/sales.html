{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href=" {% static "css/style.css" %} ">
    <link rel="stylesheet" href=" {% static "css/all.min.css" %} ">
    <link rel="stylesheet" href=" {% static "css/fontawesome.min.css" %} ">
    <title>sells page</title>
</head>
<body>
    
    <div class="maincon">
        <div class="window" id="windowcon">
            <i id="closedetwin" class="fa-solid fa-xmark close" ></i>
            <div id="detailcontainer">
                
            </div>
        </div>
        <div class="rightcon">
            <div class="minhead">
                <h3>friends</h3>
            </div>
            <ul>
                <i class="fa-solid fa-arrow-left" id="rightconexpend"></i>
                <a href="{% url "home" %}">
                    <li>
                        <i class="fa-solid fa-house-circle-check"></i>
                        <span>الرئيسية</span>
                    </li>
                </a>
                <a href= "{% url "sales" %}">
                    <li class="activeli">
                        <i class="fa-solid fa-users"></i>
                        <span>بيع</span>
                    </li>
                </a>
                <a href="{% url "tempsales" %}">
                    <li>
                        <i class="fa-solid fa-hand-holding-dollar"></i>
                        <span>الاجل</span>
                    </li>
                </a>
                <a href="{% url "loses" %}">
                    <li>
                        <i class="fa-solid fa-user-tie"></i>
                        <span>المصروفات</span>
                    </li>
                </a>
                <a href="{% url "items" %}">
                    <li >
                        <i class="fa-solid fa-file-export"></i>
                        <span>اضافة بضاعة</span>
                    </li>
                </a>
            </ul>
            <div class="minfoot">
                <a href="{% url "logout" %}">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                </a>
                <span></span>
            </div>
        </div>
        <div class="leftcon">
            <div class="status">
                <h2>جميع المنتجات</h2>
                <form method="post" action="" style="width: 100%;display: flex;align-items: center;justify-content: center;flex-direction: column;">
                    {% csrf_token %}
                    <div class="addsell">
                        <div class="wraper">
                            <div class="first">
                                <input  name="searchInput" value="{{request.POST.searchInput}}" type="text" id="search_bar" class="search_bar" required >
                                <span>بحث باسم المنتج</span>
                            </div>
                        </div>
                        <button name="search" class="sellbtn" style="width: 40px;"><i class="fa-solid fa-magnifying-glass"></i></button>
                        <a href="{% url "sales" %}" class="sellbtn" style="width: 40px; text-align:center;"><i class="fa-solid fa-arrows-rotate"></i></a>
                    </div>
                </form> 
            <div style="width: 100%; overflow: scroll;">
                {% if items %}
                <table class="sellstable">
                    <thead>
                        <tr>
                            <th>الكود</th>
                            <th>اسم المنتج</th>
                            <th>النوع</th>
                            <th>الماركة</th>
                            <th>الكمية</th>
                            <th>بيع</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in items %}
                        <tr>
                            <td>{{item.id}}</td>
                            <td>{{item.name}}</td>
                            <td>{{item.kind.name}}</td>
                            <td>{{item.prand}}</td>
                            <td>{{item.quantity}}</td>
                            {% if messages %}
                            <ul class="messages">
                                {% for message in messages %}
                                    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                            <td><button class="sellprod" id="sellsups" metadata='
                                <form method="post" action="{% url "sell" item.id %}" style="width: 100%;display: flex;align-items: center;justify-content: center;flex-direction: column;">
                                    {% csrf_token %}
                
                                    <input name="item" value="{{ item.id }}" type="hidden">
                                    <h3 style="color:#3D4B64;">بيع منتج</h3>
                                        <div class="addsell">
                                            <div style="width:50%;height:fit-content;">
                                                <ul>
                                                    <li>اسم المنتج : <span>{{item.name}}</span></li>
                                                    <li>النوع : <span>{{item.kind.name}}</span></li>
                                                    <li>الماركة : <span>{{item.prand}}</span></li>
                                                    <li>سعر المنتج : <span>{{item.price}} جنيه</span></li>
                                                    <li> الكمية المتاحة : <span>{{item.quantity}}</span></li>
                                                </ul>
                                            </div>
                                        <div style="width:50%;display:flex;justify-content:center;align-items:center;flex-direction:column;">
                                            <div class="wraper" style="width: 70%;">
                                                <div class="second">
                                                    <input name= "date" value="" type="date" id="search_bar" class="search_bar" >
                                                    <span>التاريخ</span>
                                                </div>
                                            </div>
                                            <div class="wraper" style="width: 70%;margin:10px;">
                                                <div class="second">
                                                    <input name= "client_name" value="" type="text" id="search_bar" class="search_bar" >
                                                    <span>اسم العميل</span>
                                                </div>
                                            </div>
                                            <div class="wraper" style="width: 70%;margin:10px;">
                                                <div class="second">
                                                    <input name= "client_phone" value="" type="number" id="search_bar" class="search_bar" >
                                                    <span>رقم الموبايل</span>
                                                </div>
                                            </div>
                                            <div class="wraper" style="width: 70%;margin:10px;">
                                                <div class="second">
                                                    <input name= "crash" type="text" id="search_bar" class="search_bar" >
                                                    <span>العطل</span>
                                                </div>
                                            </div>
                                            <div class="wraper" style="width: 70%;margin:10px;">
                                                <div class="second">
                                                    <select name="method"  style="font-size:18px;" id="search_bar" class="search_bar">
                                                        <option style="font-size:18px;" value="نقدية">نقدية</option>
                                                        <option style="font-size:18px;" value="محفظة">محفظة</option>
                                                    </select>
                                                    <span>طريقة الدفع</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="addsell">
                                        <div class="wraper" style="width: 20%;margin:0 10px;">
                                            <div class="second">
                                                <input name= "sale_price" min="0" value="" onkeyup="subTotal()" type="number" id="sell_price" class="search_bar" required>
                                                <span>سعر البيع</span>
                                            </div>
                                        </div>
                                        <div class="wraper" style="width: 20%;margin:0 10px;">
                                            <div class="second">
                                                <input name= "sale_quantity" min="0" value="1" type="number" onkeyup="subTotal()" id="sell_quant" class="search_bar" required>
                                                <span>الكمية المباعة</span>
                                            </div>
                                        </div>
                                        <div class="wraper" style="width: 20%;margin:0 10px;">
                                            <div class="second">
                                                <input min="0" value="1" type="number" id="sell_subTotal" class="search_bar" readonly>
                                                <span>اجمالى</span>
                                            </div>
                                        </div>
                                        <div class="wraper" style="width: 20%;margin:0 10px;">
                                            <div class="second">
                                                <input name= "paid" min="0" type="number" onkeyup="remainprice()" id="sell_pay" class="search_bar" required>
                                                <span>دفع</span>
                                            </div>
                                        </div>
                                        <div class="wraper" style="width: 20%;margin:0 10px;">
                                            <div class="second">
                                                <input name= "remain" min="0" value="" type="number" id="sell_remain" class="search_bar" readonly >
                                                <span>الباقى</span>
                                            </div>
                                        </div>
                                    </div>
                                    <button name= "sell" class="sellbtn">بيع</button>
                                </form>
                                '>sell</button></td>
                            </tr>
                            {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="btnnav">
                <div>
                    {% if items.has_previous %}
                    <a href="?page=1"><i class="fa-solid fa-angles-right"></i></a>
                    <a href="?page={{ items.previous_page_number }}"><i class="fa-solid fa-chevron-right"></i></a>
                    {% endif %}
                    <p>صفحة {{ items.number }} من {{ items.paginator.num_pages }}</p>
                </div>
                <div>
                    {% if items.has_next %}
                    <a href="?page={{ items.next_page_number }}"><i class="fa-solid fa-chevron-left"></i></a>
                    <a href="?page={{ items.paginator.num_pages }}"><i class="fa-solid fa-angles-left"></i></a>
                    {% endif %}

                </div>
            </div>
        </div>
    </div>
    {% else %}
    <h2 style="width: 100%;text-align: center;color: #303C54;margin-bottom: 20px;">لا يوجد بضاعة</h2>
    {% endif %}
    </div>
    <script src="{% static "js/select.js" %}  "></script>
    <script src=" {% static "js/main.js" %} "></script>
    <script>
        const sellsups = document.querySelectorAll('#sellsups');
            sellsups.forEach((sellsup)=>{
                sellsup.onclick=()=>{
                const metadata = sellsup.getAttribute('metadata');
                windowcon.style.visibility = 'visible'
                windowcon.style.opacity = '1'
                document.getElementById('detailcontainer').innerHTML=metadata;
            }
        });
        function subTotal(){
            const sell_price = document.getElementById('sell_price');
            const sell_quant = document.getElementById('sell_quant');
            const sell_subTotal = document.getElementById('sell_subTotal');
            sell_subTotal.value=parseFloat(sell_price.value*sell_quant.value);
            
        }
        function remainprice(){
            const sell_pay = document.getElementById('sell_pay');
            const sell_subTotal = document.getElementById('sell_subTotal');
            const sell_remain = document.getElementById('sell_remain');
        sell_remain.value=parseFloat(sell_subTotal.value-sell_pay.value);
        }
    </script>
</body>
</html>